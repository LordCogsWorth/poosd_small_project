<!DOCTYPE html>
<html lang="en">
<head>
    <title>POOSD Small Project - Contact Manager</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="css/main.css">
    <!-- Include Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script type="text/javascript" src="js/main.js"></script> <!-- Updated script file -->

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            loadContacts(); // Loads contacts dynamically
        }, false);
    </script>
</head>

<body>
    <div class="sidebar">
        <img src="images/logo.png" alt="Company Logo" class="company-logo">
        <h2>Contacts</h2>
        <ul>
            <li id="viewContactsBtn">
                <i class="fas fa-user"></i>  All Contacts
            </li>
            <li id="addContactViewBtn">
                <i class="fas fa-plus"></i> Create Contact <!-- Blank icon (circle) -->
            </li>
        </ul>
        <span id="userName">Test Account</span> <!-- Simulate a logged-in user -->
        <button type="button" id="logoutBtn" class="logout-button" onclick="doLogOut();">Logout</button>
    </div>
    
    <div class="main-content">
        <h1 id="title">COP 4331 Small Project - Contact Manager</h1>
        <div id="contactsView">
            <div class="searchBar">
                <input type="text" id="search" class="search-bar" placeholder="Search contacts" onkeyup="filterContacts()">
            </div>
        
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Company</th>
                        <th>Email</th>
                        <th>Notes</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="contactTable">
                    <!-- Contacts will be dynamically loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Adding Contacts -->
        <div id="addContactView" style="display: none;">
            <h2>Add New Contact</h2>
            <form id="addContactForm">
                <input type="text" id="contactFirstName" placeholder="First Name" required>
                <input type="text" id="contactLastName" placeholder="Last Name" required>
                <input type="text" id="contactCompany" placeholder="Company">
                <input type="email" id="contactEmail" placeholder="Email" required>
                <input type="tel" id="contactPhone" placeholder="Phone Number" 
                       pattern="[0-9]+" title="Please enter numbers only (e.g., 1234567890)" required>
                <input type="text" id="contactNotes" placeholder="Notes">
            </form>
            <br>
            <button type="button" id="addContactButton" class="buttons" onclick="addContact();">Add Contact</button>
            <span id="ContactAddResult"></span>
        </div>
    </div>

    <script type="text/javascript">
        // Hard-coded contact data for a single account
        let contacts = [
            {
                id: 1,
                firstName: "John",
                lastName: "Doe",
                phone: "1234567890",
                company: "ABC Corp",
                email: "john.doe@example.com",
                notes: "Sample contact 1"
            },
            {
                id: 2,
                firstName: "Jane",
                lastName: "Smith",
                phone: "9876543210",
                company: "XYZ Inc",
                email: "jane.smith@example.com",
                notes: "Sample contact 2"
            },
            {
                id: 3,
                firstName: "Alice",
                lastName: "Johnson",
                phone: "5551234567",
                company: "Tech Solutions",
                email: "alice.johnson@example.com",
                notes: "Sample contact 3"
            }
        ];

        // Load contacts into the table
        function loadContacts() {
            console.log('Refreshing table...'); // Debugging log
            const tableBody = document.getElementById('contactTable');
            tableBody.innerHTML = ''; // Clear existing rows
            contacts.forEach(contact => {
                const row = document.createElement('tr');
                row.setAttribute('data-id', contact.id); // Add data-id attribute for editing
                row.innerHTML = `
                    <td>${contact.firstName} ${contact.lastName}</td>
                    <td>${contact.phone}</td>
                    <td>${contact.company}</td>
                    <td>${contact.email}</td>
                    <td>${contact.notes}</td>
                    <td>
                        <button onclick="editContact('${contact.id}')"> <i class="fas fa-edit"></i></button>
                        <button onclick="deleteContact('${contact.id}')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Filter contacts based on search query across all fields
        function filterContacts() {
            const searchQuery = document.getElementById('search').value.toLowerCase();
            const rows = document.querySelectorAll('#contactTable tr');
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const phone = row.cells[1].textContent.toLowerCase();
                const company = row.cells[2].textContent.toLowerCase();
                const email = row.cells[3].textContent.toLowerCase();
                const notes = row.cells[4].textContent.toLowerCase();

                // Check if any field matches the search query
                if (
                    name.includes(searchQuery) ||
                    phone.includes(searchQuery) ||
                    company.includes(searchQuery) ||
                    email.includes(searchQuery) ||
                    notes.includes(searchQuery)
                ) {
                    row.style.display = ''; // Show the row
                } else {
                    row.style.display = 'none'; // Hide the row
                }
            });
        }

        // Add a new contact
        function addContact() {
            alert('addContact() is being called!'); // Debugging alert

            const phoneInput = document.getElementById('contactPhone');
            const phoneValue = phoneInput.value.trim();

            // Validate phone number (must contain only numbers)
            if (!/^\d+$/.test(phoneValue)) {
                document.getElementById('ContactAddResult').textContent = 'Phone number must contain only numbers.';
                document.getElementById('ContactAddResult').style.color = 'red';
                phoneInput.focus();
                return; // Stop the function if validation fails
            }

            const newContact = {
                id: contacts.length + 1, // Generate a new ID
                firstName: document.getElementById('contactFirstName').value,
                lastName: document.getElementById('contactLastName').value,
                company: document.getElementById('contactCompany').value,
                email: document.getElementById('contactEmail').value,
                phone: phoneValue,
                notes: document.getElementById('contactNotes').value,
            };
            contacts.push(newContact); // Add to the hard-coded list
            console.log('New contact added:', newContact); // Debugging log
            console.log('Updated contacts array:', contacts); // Debugging log

            // Update the result message
            document.getElementById('ContactAddResult').textContent = 'Contact added successfully!';
            document.getElementById('ContactAddResult').style.color = 'green';

            loadContacts(); // Refresh the table
            document.getElementById('addContactForm').reset(); // Clear the form
            console.log('Form reset'); // Debugging log
        }

        // Edit an existing contact
        function editContact(id) {
            const contact = contacts.find(c => c.id === parseInt(id));
            if (contact) {
                const row = document.querySelector(`#contactTable tr[data-id='${id}']`);
                if (row) {
                    row.innerHTML = `
                        <td>
                            <input type="text" value="${contact.firstName}" placeholder="First Name">
                            <input type="text" value="${contact.lastName}" placeholder="Last Name">
                        </td>
                        <td><input type="text" value="${contact.phone}" placeholder="Phone"></td>
                        <td><input type="text" value="${contact.company}" placeholder="Company"></td>
                        <td><input type="email" value="${contact.email}" placeholder="Email"></td>
                        <td><input type="text" value="${contact.notes}" placeholder="Notes"></td>
                        <td>
                            <button onclick="saveContact('${contact.id}')">Save</button>
                            <button onclick="cancelEdit('${contact.id}')">Cancel</button>
                        </td>
                    `;
                }
            }
        }

        // Save edited contact
        function saveContact(id) {
            const contact = contacts.find(c => c.id === parseInt(id));
            if (contact) {
                const row = document.querySelector(`#contactTable tr[data-id='${id}']`);
                if (row) {
                    contact.firstName = row.cells[0].querySelector('input[placeholder="First Name"]').value;
                    contact.lastName = row.cells[0].querySelector('input[placeholder="Last Name"]').value;
                    contact.phone = row.cells[1].querySelector('input').value;
                    contact.company = row.cells[2].querySelector('input').value;
                    contact.email = row.cells[3].querySelector('input').value;
                    contact.notes = row.cells[4].querySelector('input').value;
                    loadContacts(); // Refresh the table
                }
            }
        }

        // Cancel editing
        function cancelEdit(id) {
            loadContacts(); // Refresh the table to revert changes
        }

        // Delete an existing contact
        function deleteContact(id) {
            if (confirm('Are you sure you want to delete this contact?')) {
                contacts = contacts.filter(c => c.id !== parseInt(id));
                loadContacts(); // Refresh the table
            }
        }

        // Toggle between views
        document.getElementById('viewContactsBtn').addEventListener('click', () => {
            document.getElementById('contactsView').style.display = 'block';
            document.getElementById('addContactView').style.display = 'none';
        });

        document.getElementById('addContactViewBtn').addEventListener('click', () => {
            document.getElementById('contactsView').style.display = 'none';
            document.getElementById('addContactView').style.display = 'block';
        });

        // Simulate logout (for testing purposes)
        function doLogOut() {
            alert('Logout clicked!'); // Replace with actual logout logic later
        }
    </script>
</body>
</html>